import{o as M,n as O,a as P,u as U,g as x,r as h,t as T,b as B,w as F,c as I,d as G,e as J,f as K,h as V}from"./index-DWPvFz-A.js";import{D as R,a as W,b as $}from"./conf-B_uLuYoE.js";function j(){return document.getElementById(W)??void 0}function q(){return new window.APlayer({container:j(),lrcType:R,audio:[],mutex:!0,preload:"auto",order:"list"})}function A(e){return typeof e=="function"?e():U(e)}const H=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Y=()=>{};function S(e){return x()}function z(e,o=!0,a){S()?M(e,a):o?e():O(e)}function N(e,o){S()&&P(e,o)}const Q=H?window.document:void 0;function X(e,o=Y,a={}){const{immediate:r=!0,manual:s=!1,type:d="text/javascript",async:i=!0,crossOrigin:f,referrerPolicy:y,noModule:u,defer:m,document:t=Q,attrs:l={}}=a,v=h(null);let g=null;const b=p=>new Promise((k,E)=>{const w=c=>(v.value=c,k(c),c);if(!t){k(!1);return}let C=!1,n=t.querySelector(`script[src="${A(e)}"]`);n?n.hasAttribute("data-loaded")&&w(n):(n=t.createElement("script"),n.type=d,n.async=i,n.src=A(e),m&&(n.defer=m),f&&(n.crossOrigin=f),u&&(n.noModule=u),y&&(n.referrerPolicy=y),Object.entries(l).forEach(([c,D])=>n==null?void 0:n.setAttribute(c,D)),C=!0),n.addEventListener("error",c=>E(c)),n.addEventListener("abort",c=>E(c)),n.addEventListener("load",()=>{n.setAttribute("data-loaded","true"),o(n),w(n)}),C&&(n=t.head.appendChild(n)),p||w(n)}),L=(p=!0)=>(g||(g=b(p)),g),_=()=>{if(!t)return;g=null,v.value&&(v.value=null);const p=t.querySelector(`script[src="${A(e)}"]`);p&&t.head.removeChild(p)};return r&&!s&&z(L),s||N(_),{scriptTag:v,load:L,unload:_}}function Z(){const e=h(),o=async t=>{e.value.on("loadeddata",()=>{console.log("aplayerLoadeddata:",new Date().toString()),t()})},a=t=>{t()},r=()=>{e.value.toggle()},s=()=>{e.value.skipForward()},d=()=>{e.value.skipBack()},i=t=>{e.value.volume(t,!0)};return{aplayerRef:e,onAplayerLoadeddata:o,onAplayerReady:a,skipForward:s,skipBack:d,toggle:r,volume:i,changePlayList:t=>{!T(e)||!T(e).list||(e.value.list.clear(),e.value.list.add(t))},onKeydown:t=>{document.addEventListener("keydown",l=>{l.code==="Space"&&(l.preventDefault(),r()),l.keyCode===39&&(l.preventDefault(),s()),l.keyCode===37&&(l.preventDefault(),d()),l.keyCode===38&&t.volume<=1&&(t.volume+=.1,i(t.volume)),l.keyCode===40&&t.volume>=0&&(t.volume+=-.1,i(t.volume))})},pause:()=>{e.value.pause()},destroy:()=>{e.value.destroy()}}}async function ee(e,o){const a=h(),{aplayerRef:r,onKeydown:s,onAplayerLoadeddata:d,onAplayerReady:i,changePlayList:f,pause:y}=Z(),u=B({volume:e.volume,lrcType:e.lrcType,songs:e.songs});return F(()=>u.songs,m=>{f(m)}),I(()=>{u.volume=e.volume,u.lrcType=e.lrcType,u.songs=e.songs}),P(()=>{y(),r.value=null}),await te(r),s(u),i(()=>o("aplayerReady")),d(()=>o("aplayerLoadeddata")),{containerRef:a,aplayerRef:r}}async function te(e){const o=new URL(""+new URL("../APlayer.min.js",import.meta.url).href,import.meta.url).href,{load:a,unload:r}=X(o,()=>{e.value=q()},{manual:!0});await a(),r()}const ne=G({name:"AplayerJs",inheritAttrs:!1,__name:"index",props:{volume:{default:$},songs:{default:()=>[]},lrcType:{default:R}},emits:["aplayerLoadeddata","aplayerReady"],async setup(e,{emit:o}){let a,r;const s=e,d=o,{containerRef:i}=([a,r]=J(()=>ee(s,d)),a=await a,r(),a);return(f,y)=>(K(),V("div",{ref_key:"containerRef",ref:i},null,512))}}),re=ne;export{re as default};
